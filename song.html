
<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Píseň</title>
  <link rel="stylesheet" href="assets/style.css" />
  <script defer src="https://unpkg.com/@coderline/alphatab@latest/dist/alphaTab.min.js"></script>
</head>
<body>
  <div class="container">
    <a href="index.html">← Zpět na seznam</a>
    <div class="card" style="margin-top:12px">
      <h2 id="title" style="margin-top:0">Načítám…</h2>
      <div class="badge" id="meta"></div>
      <div class="player" style="margin:12px 0">
        <button id="play">Přehrát</button>
        <button id="stop">Stop</button>
        <label>Tempo <input id="tempo" type="range" min="30" max="200" value="100"></label>
      </div>
      <div id="alphaTab" class="card" style="overflow:auto; max-height:70vh"></div>
    </div>
  </div>

<script>
const params = new URLSearchParams(location.search);
const id = params.get('id');
let song;

async function load(){
  try{
    const data = await fetch('data/songs.json', {cache:'no-store'}).then(r=>r.json());
    song = data.find(s => s.id === id);
  }catch(e){
    song = null;
  }
  if(!song){
    document.getElementById('title').textContent = 'Píseň nenalezena';
    return;
  }
  document.getElementById('title').textContent = `${song.number ?? '–'} · ${song.title}`;
  document.getElementById('meta').textContent = song.author || '';
  initAlphaTab(song.file);
}

let at;
function initAlphaTab(file){
  const el = document.getElementById('alphaTab');
  at = new alphaTab.AlphaTabApi(el, { file, player: { enablePlayer: true } });
  document.getElementById('play').onclick = ()=> at.playPause();
  document.getElementById('stop').onclick = ()=> at.stop();
  document.getElementById('tempo').oninput = (e)=> at.playbackSpeed = e.target.value/100;
}

load();
</script>
</body>
</html>
