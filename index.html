<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Zpjƒõvn√≠ƒçek</title>

  <link rel="stylesheet" href="/zpjevnicek/assets/style.css" />
  <link rel="manifest" href="/zpjevnicek/manifest.webmanifest" />
  <meta name="theme-color" content="#0f1729" />
  <link rel="apple-touch-icon" href="/zpjevnicek/assets/icons/icon-192.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="Zpjƒõvn√≠ƒçek" />

  <!-- Overrides -->
  <style>
    /* ‚¨á‚¨á‚¨á Odsazen√≠ od kraj≈Ø + ≈°√≠≈ôka str√°nky (uprav jen tyto t≈ôi ≈ô√°dky podle chuti) */
    .container{ max-width:min(1200px,96vw); padding-left:2px; padding-right:2px; }
    /* Bez ‚Äûbubliny‚Äú kolem seznamu */
    .card{ background:transparent!important; border:0!important; box-shadow:none!important; padding:0!important; margin:0!important; }
    .card .sep{ display:none!important; }

    /* Layout polo≈æek seznamu + ellipsy */
    #list{ margin:0; padding:0; list-style:none; }
    .item{ display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px 0; border-bottom:1px solid #1f2b46; }
    .item .meta{ display:flex; align-items:center; gap:10px; min-width:0; flex:1; }

    /* Stejn√° bublina pro ƒç√≠sla (fixn√≠ pr≈Ømƒõr) + zarovn√°n√≠ */
    .item .meta .badge:first-child{
      width:38px; min-width:38px; height:38px; border-radius:999px;
      display:inline-flex; align-items:center; justify-content:center; padding:0;
      font-variant-numeric: tabular-nums;
    }

    /* N√°zev ‚Äì v≈ædy jeden ≈ô√°dek s ‚Ä¶, zabere zbytek m√≠sta mezi ƒç√≠slem a autorem */
    .item .meta .title{
      display:block; flex:1; min-width:0;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    /* Autor vpravo ‚Äì tak√© jeden ≈ô√°dek s ‚Ä¶; uprav max-width dle pot≈ôeby */
    .item > .badge{
      max-width:40%; min-width:0;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    /* Filtry bez extra mezer, kdy≈æ nen√≠ card padding */
    .controls{ margin:8px 0 10px; display:flex; gap:10px; }
    .controls input{ flex:1; }
/* --- Vyrovnan√© mezery mezi p√≠smeny v logu --- */
.logo {
  display: flex;
  align-items: baseline;
  gap: 0.05em;             /* jednotn√° mezera mezi p√≠smeny ‚Äì uprav podle oka (0.15‚Äì0.2em) */
  flex-wrap: nowrap;       /* a≈• se to nel√°me na dva ≈ô√°dky */
}

.logo span {
  display: inline-block;
  letter-spacing: 0;       /* vypni vnit≈ôn√≠ spacing */
  margin: 0;
  padding: 0;
}

    
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="brand">
        <h1 class="logo">
          <span class="w">Z</span>
          <span class="w">p</span>
          <span class="gray">j</span>
          <span class="e">
            <span class="gray">e</span>
            <span class="w h√°ƒçek">Àá</span>
          </span>
          <span class="w">v</span>
          <span class="gray">n√≠ƒçek</span>
        </h1>
      </div>
    </div>

    <div class="card">
      <div class="controls">
        <input id="q" placeholder="Hledat n√°zev / autor / ƒç√≠slo‚Ä¶" />
        <select id="sort">
          <option value="number">≈òadit podle ƒç√≠sla</option>
          <option value="title">≈òadit podle abecedy</option>
          <option value="author">≈òadit podle autora</option>
        </select>
      </div>

      <ul id="list"></ul>
      <div id="empty" class="empty" style="display:none">
        Zat√≠m tu nic nen√≠. Nahraj soubory do slo≈æky <code>/songs</code>.
      </div>
    </div>

    <div class="footer">üé∏ GitHub Pages ¬∑ alphaTab</div>
  </div>

<script>
const list = document.getElementById('list');
const q = document.getElementById('q');
const sort = document.getElementById('sort');
const empty = document.getElementById('empty');
let songs = [];

async function load(){
  try{
    const res = await fetch('/zpjevnicek/data/songs.json', { cache: 'no-store' });
    songs = await res.json();
  }catch(e){ songs = []; }
  render();
}
function render(){
  const term = q.value.trim().toLowerCase();
  const srt = sort.value;
  let data = songs.filter(s =>
    s.title.toLowerCase().includes(term) ||
    (s.author||'').toLowerCase().includes(term) ||
    String(s.number||'').includes(term)
  );
  data.sort((a,b)=>{
    if(srt==='number') return (a.number??99999)-(b.number??99999) || a.title.localeCompare(b.title);
    if(srt==='author') return (a.author||'').localeCompare(b.author||'') || a.title.localeCompare(b.title);
    return a.title.localeCompare(b.title);
  });
  list.innerHTML = data.map(s => `
    <li class="item">
      <div class="meta">
        <span class="badge">${s.number ?? '‚Äì'}</span>
        <a class="title" href="/zpjevnicek/song.html?id=${encodeURIComponent(s.id)}">${s.title}</a>
      </div>
      <div class="badge">${s.author || ''}</div>
    </li>`).join('');
  empty.style.display = data.length ? 'none' : 'block';
}
q.addEventListener('input', render);
sort.addEventListener('change', render);
load();
</script>

<!-- SW + auto-update -->
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', async () => {
    try {
      const reg = await navigator.serviceWorker.register('/zpjevnicek/sw.js', { scope: '/zpjevnicek/' });
      if (reg.waiting) reg.waiting.postMessage({ type: 'SKIP_WAITING' });
      reg.addEventListener('updatefound', () => {
        const sw = reg.installing;
        if (!sw) return;
        sw.addEventListener('statechange', () => {
          if (sw.state === 'installed' && navigator.serviceWorker.controller) {
            sw.postMessage({ type: 'SKIP_WAITING' });
          }
        });
      });
      let refreshing = false;
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        if (refreshing) return; refreshing = true; window.location.reload();
      });
      setInterval(() => reg.update().catch(()=>{}), 60*60*1000);
    } catch (e) { console.error(e); }
  });
}
</script>

<!-- Prefetch v≈°ech p√≠sn√≠ p≈ôi dobr√©m p≈ôipojen√≠ -->
<script>
function goodConnection(){
  const c = navigator.connection || navigator.webkitConnection || navigator.mozConnection;
  if (!c) return true;
  if (c.saveData) return false;
  const okTypes = ['wifi','ethernet','unknown'];
  return okTypes.includes(c.type) || (c.effectiveType || '').includes('4g');
}
async function prefetchAllSongs(){
  if (!navigator.onLine) return;
  if (!goodConnection()) return;
  try{
    const reg = await navigator.serviceWorker.getRegistration('/zpjevnicek/');
    if (reg && reg.active) reg.active.postMessage({ type: 'CACHE_ALL_SONGS', chunkSize: 6, reportProgress: false });
  }catch(e){ console.warn(e); }
}
window.addEventListener('load', prefetchAllSongs);
setInterval(prefetchAllSongs, 30*60*1000);
</script>

<!-- Glob√°ln√≠ aplikace ulo≈æen√© velikosti textu -->
<script>
const ZPJ_FONT_KEY = 'zpj-fontScale';
(function applyGlobalSongScale(){
  const val = parseFloat(localStorage.getItem(ZPJ_FONT_KEY));
  if (!isNaN(val) && val > 0) {
    document.documentElement.style.setProperty('--song-scale', String(val));
  }
})();
</script>
</body>
</html>
